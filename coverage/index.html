<!DOCTYPE html>
<html xmlns='http://www.w3.org/1999/xhtml'>
  <head>
    <title>Code coverage for Flowrb</title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <script src='./assets/0.13.2/application.js' type='text/javascript'></script>
    <link href='./assets/0.13.2/application.css' media='screen, projection, print' rel='stylesheet' type='text/css' />
    <link rel="icon" type="image/png" href="./assets/0.13.2/favicon_green.png" />
  </head>

  <body data-branch-coverage=true>
    <div id="loading">
      <img src="./assets/0.13.2/loading.gif" alt="loading"/>
    </div>
    <div id="wrapper" class="hide">
      <div class="timestamp">Generated <abbr class="timeago" title="2026-02-02T11:15:28+01:00">2026-02-02T11:15:28+01:00</abbr></div>
      <ul class="group_tabs"></ul>

      <div id="content">
        <div class="file_list_container" id="AllFiles">
  <h2>
    <span class="group_name">All Files</span>
    (<span class="covered_percent">
      <span class="green">
  97.47%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="green">
         247.24
       </span>
    </span> hits/line
    )
  </h2>

  <a name="AllFiles"></a>

  <div>
    <b>10</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>554</b> relevant lines,
    <span class="green"><b>540</b> lines covered</span> and
    <span class="red"><b>14</b> lines missed. </span>
    (<span class="green">
  97.47%
</span>
)
  </div>

  
    <div class="t-branch-summary">
      <span><b>138</b> total branches, </span>
      <span class="green"><b>124</b> branches covered</span> and
      <span class="red"><b>14</b> branches missed.</span>
      (<span class="yellow">
  89.86%
</span>
)
    </div>
  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
            <th class="cell--number">Branch Coverage</th>
            <th class="cell--number">Branches</th>
            <th class="cell--number">Covered branches</th>
            <th class="cell--number">Missed branches </th>
          
        </tr>
      </thead>
      <tbody>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#00790bc11583e09197c7d7d52faeba1846b51194" class="src_link" title="lib/piperb.rb">lib/piperb.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">39</td>
            <td class="cell--number">14</td>
            <td class="cell--number">14</td>
            <td class="cell--number">0</td>
            <td class="cell--number">25.50</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#4bc4ea89cb70178521f65112141dd121f2df0ace" class="src_link" title="lib/piperb/cache.rb">lib/piperb/cache.rb</a></td>
            <td class="green strong cell--number t-file__coverage">91.67 %</td>
            <td class="cell--number">121</td>
            <td class="cell--number">60</td>
            <td class="cell--number">55</td>
            <td class="cell--number">5</td>
            <td class="cell--number">53.87</td>
            
              <td class="red strong cell--number t-file__branch-coverage">75.00 %</td>
              <td class="cell--number">4</td>
              <td class="cell--number">3</td>
              <td class="cell--number">1</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#df4ee5c352c9f6aacc8c38afc427715b681ca2d7" class="src_link" title="lib/piperb/dag.rb">lib/piperb/dag.rb</a></td>
            <td class="green strong cell--number t-file__coverage">97.92 %</td>
            <td class="cell--number">196</td>
            <td class="cell--number">96</td>
            <td class="cell--number">94</td>
            <td class="cell--number">2</td>
            <td class="cell--number">366.56</td>
            
              <td class="yellow strong cell--number t-file__branch-coverage">88.46 %</td>
              <td class="cell--number">26</td>
              <td class="cell--number">23</td>
              <td class="cell--number">3</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#71463d1030d09ce814e27aaa6f3d8659aa5c4504" class="src_link" title="lib/piperb/errors.rb">lib/piperb/errors.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">61</td>
            <td class="cell--number">32</td>
            <td class="cell--number">32</td>
            <td class="cell--number">0</td>
            <td class="cell--number">17.44</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#08b7564565af4050dc638d634122a0aad64f0c3c" class="src_link" title="lib/piperb/executor/base.rb">lib/piperb/executor/base.rb</a></td>
            <td class="green strong cell--number t-file__coverage">99.11 %</td>
            <td class="cell--number">244</td>
            <td class="cell--number">112</td>
            <td class="cell--number">111</td>
            <td class="cell--number">1</td>
            <td class="cell--number">249.93</td>
            
              <td class="green strong cell--number t-file__branch-coverage">94.44 %</td>
              <td class="cell--number">54</td>
              <td class="cell--number">51</td>
              <td class="cell--number">3</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#dde360fa7a8023b58621faf3d37b5eb5a4a0bd3f" class="src_link" title="lib/piperb/executor/parallel.rb">lib/piperb/executor/parallel.rb</a></td>
            <td class="green strong cell--number t-file__coverage">98.51 %</td>
            <td class="cell--number">127</td>
            <td class="cell--number">67</td>
            <td class="cell--number">66</td>
            <td class="cell--number">1</td>
            <td class="cell--number">136.36</td>
            
              <td class="green strong cell--number t-file__branch-coverage">93.75 %</td>
              <td class="cell--number">16</td>
              <td class="cell--number">15</td>
              <td class="cell--number">1</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#5fb4052aa1599a0e4a15e928eaeb1cae48b5fecd" class="src_link" title="lib/piperb/executor/sequential.rb">lib/piperb/executor/sequential.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">79</td>
            <td class="cell--number">34</td>
            <td class="cell--number">34</td>
            <td class="cell--number">0</td>
            <td class="cell--number">347.21</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">6</td>
              <td class="cell--number">6</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#981f896da180be5de83a0cd67e4b4b281e9cea99" class="src_link" title="lib/piperb/pipeline.rb">lib/piperb/pipeline.rb</a></td>
            <td class="yellow strong cell--number t-file__coverage">87.80 %</td>
            <td class="cell--number">90</td>
            <td class="cell--number">41</td>
            <td class="cell--number">36</td>
            <td class="cell--number">5</td>
            <td class="cell--number">171.90</td>
            
              <td class="red strong cell--number t-file__branch-coverage">58.33 %</td>
              <td class="cell--number">12</td>
              <td class="cell--number">7</td>
              <td class="cell--number">5</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#1bfe9d8600c4b5ad878e0972ebd5743ea3f85dc7" class="src_link" title="lib/piperb/result.rb">lib/piperb/result.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">116</td>
            <td class="cell--number">53</td>
            <td class="cell--number">53</td>
            <td class="cell--number">0</td>
            <td class="cell--number">340.81</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">12</td>
              <td class="cell--number">12</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#2fa213accbaf6ee333c08afa4fb43ece9e83a48d" class="src_link" title="lib/piperb/step.rb">lib/piperb/step.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">92</td>
            <td class="cell--number">45</td>
            <td class="cell--number">45</td>
            <td class="cell--number">0</td>
            <td class="cell--number">524.24</td>
            
              <td class="yellow strong cell--number t-file__branch-coverage">87.50 %</td>
              <td class="cell--number">8</td>
              <td class="cell--number">7</td>
              <td class="cell--number">1</td>
            
          </tr>
        
      </tbody>
    </table>
  </div>
</div>


        
      </div>

      <div id="footer">
        Generated by <a href="https://github.com/simplecov-ruby/simplecov">simplecov</a> v0.22.0
        and simplecov-html v0.13.2<br/>
        using RSpec
      </div>

      <div class="source_files">
      
        <div class="source_table" id="00790bc11583e09197c7d7d52faeba1846b51194">
  <div class="header">
    <h3>lib/piperb.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>14</b> relevant lines.
      <span class="green"><b>14</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>0</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">require_relative &#39;piperb/version&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">require_relative &#39;piperb/errors&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="5">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">require_relative &#39;piperb/step&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="6">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">require_relative &#39;piperb/dag&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="7">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">require_relative &#39;piperb/result&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="8">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">require_relative &#39;piperb/cache&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="9">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">require_relative &#39;piperb/executor/base&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="10">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">require_relative &#39;piperb/executor/sequential&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="11">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">require_relative &#39;piperb/executor/parallel&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="12">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">require_relative &#39;piperb/pipeline&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby"># Piperb is a Ruby dataflow and pipeline library with declarative step</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby"># definitions, automatic dependency resolution, and sequential execution.</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="16">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">module Piperb</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="17">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  class &lt;&lt; self</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby">    # Define a new pipeline using the DSL.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby">    #</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby">    # @example</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby">    #   pipeline = Piperb.define do</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby">    #     step :fetch do</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby">    #       [1, 2, 3]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby">    #     end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby">    #</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby">    #     step :transform, depends_on: :fetch do |data|</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby">    #       data.map { |n| n * 2 }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby">    #     end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby">    #   end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby">    #</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby">    #   result = pipeline.run</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby">    #</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby">    # @yield Block containing step definitions</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby">    # @return [Piperb::Pipeline] The defined pipeline</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="35">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def define(&amp;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="344" data-linenumber="36">
            
              <span class="hits">344</span>
            

            
              
            

            <code class="ruby">      Pipeline.new(&amp;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="4bc4ea89cb70178521f65112141dd121f2df0ace">
  <div class="header">
    <h3>lib/piperb/cache.rb</h3>
    <h4>
      <span class="green">
  91.67%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  75.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>60</b> relevant lines.
      <span class="green"><b>55</b> lines covered</span> and
      <span class="red"><b>5</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>4</b> total branches, </span>
          <span class="green"><b>3</b> branches covered</span> and
          <span class="red"><b>1</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">require &#39;fileutils&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">require &#39;digest&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="6">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">module Piperb</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            
              
            

            <code class="ruby">  # Caching support for pipeline step results (Luigi-style).</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby">  # Allows resuming failed pipelines from the last successful step.</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="9">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  module Cache</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby">    # Abstract base class for cache stores.</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="11">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    class Base</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="12">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def exist?(_key)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="13">
            

            
              
            

            <code class="ruby">        raise NotImplementedError</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="16">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def read(_key)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="17">
            

            
              
            

            <code class="ruby">        raise NotImplementedError</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="20">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def write(_key, _value)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="21">
            

            
              
            

            <code class="ruby">        raise NotImplementedError</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="24">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def delete(_key)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="25">
            

            
              
            

            <code class="ruby">        raise NotImplementedError</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="28">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def clear</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="29">
            

            
              
            

            <code class="ruby">        raise NotImplementedError</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby">    # In-memory cache store. Useful for testing and single-run caching.</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="34">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    class MemoryStore &lt; Base</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="35">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def initialize</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="60" data-linenumber="36">
            
              <span class="hits">60</span>
            

            
              
            

            <code class="ruby">        super</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="60" data-linenumber="37">
            
              <span class="hits">60</span>
            

            
              
            

            <code class="ruby">        @data = {}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="40">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def exist?(key)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="163" data-linenumber="41">
            
              <span class="hits">163</span>
            

            
              
            

            <code class="ruby">        @data.key?(key.to_s)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="44">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def read(key)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1060" data-linenumber="45">
            
              <span class="hits">1060</span>
            

            
              
            

            <code class="ruby">        @data[key.to_s]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="48">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def write(key, value)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1101" data-linenumber="49">
            
              <span class="hits">1101</span>
            

            
              
            

            <code class="ruby">        @data[key.to_s] = value</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="52">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def delete(key)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="53">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">        @data.delete(key.to_s)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="56">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def clear</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="57">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        @data.clear</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            

            
              
            

            <code class="ruby">    # File-based cache store. Persists results to disk for cross-run caching.</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="62">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    class FileStore &lt; Base</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="63">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      attr_reader :dir</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="65">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def initialize(dir)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="25" data-linenumber="66">
            
              <span class="hits">25</span>
            

            
              
            

            <code class="ruby">        super()</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="25" data-linenumber="67">
            
              <span class="hits">25</span>
            

            
              
            

            <code class="ruby">        @dir = dir</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="25" data-linenumber="68">
            
              <span class="hits">25</span>
            

            
              
            

            <code class="ruby">        FileUtils.mkdir_p(dir)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="71">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def exist?(key)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="45" data-linenumber="72">
            
              <span class="hits">45</span>
            

            
              
            

            <code class="ruby">        File.exist?(path_for(key))</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="75">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def read(key)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="76">
            
              <span class="hits">19</span>
            

            
              
                <span class="hits" title="else branch hit 18 times">
                  else: 18
                </span>
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">        return nil unless exist?(key)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="78">
            
              <span class="hits">18</span>
            

            
              
            

            <code class="ruby">        File.open(path_for(key), &#39;rb&#39;) do |f|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="79">
            
              <span class="hits">18</span>
            

            
              
            

            <code class="ruby">          Marshal.load(f.read) # rubocop:disable Security/MarshalLoad</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            

            
              
            

            <code class="ruby">      rescue StandardError</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="82">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        nil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="85">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def write(key, value)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28" data-linenumber="86">
            
              <span class="hits">28</span>
            

            
              
            

            <code class="ruby">        File.binwrite(path_for(key), Marshal.dump(value))</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="87">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="89">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def delete(key)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="2" data-linenumber="90">
            
              <span class="hits">2</span>
            

            
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">        File.delete(path_for(key)) if exist?(key)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="92">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="93">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def clear</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="94">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        FileUtils.rm_rf(Dir.glob(File.join(dir, &#39;*.cache&#39;)))</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="96">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="97">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="98">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="99">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def path_for(key)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="100">
            

            
              
            

            <code class="ruby">        # Sanitize key to create safe filename</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="93" data-linenumber="101">
            
              <span class="hits">93</span>
            

            
              
            

            <code class="ruby">        safe_key = Digest::SHA256.hexdigest(key.to_s)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="93" data-linenumber="102">
            
              <span class="hits">93</span>
            

            
              
            

            <code class="ruby">        File.join(dir, &quot;#{safe_key}.cache&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="103">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="104">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="105">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="106">
            

            
              
            

            <code class="ruby">    # Represents a cached step result</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="107">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    class CachedResult</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="108">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      attr_reader :output, :status, :skipped</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="109">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="110">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def initialize(output:, status:, skipped: false)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="99" data-linenumber="111">
            
              <span class="hits">99</span>
            

            
              
            

            <code class="ruby">        @output = output</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="99" data-linenumber="112">
            
              <span class="hits">99</span>
            

            
              
            

            <code class="ruby">        @status = status</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="99" data-linenumber="113">
            
              <span class="hits">99</span>
            

            
              
            

            <code class="ruby">        @skipped = skipped</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="114">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="115">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="116">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def skipped?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="58" data-linenumber="117">
            
              <span class="hits">58</span>
            

            
              
            

            <code class="ruby">        @skipped</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="118">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="119">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="120">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="121">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="df4ee5c352c9f6aacc8c38afc427715b681ca2d7">
  <div class="header">
    <h3>lib/piperb/dag.rb</h3>
    <h4>
      <span class="green">
  97.92%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="yellow">
  88.46%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>96</b> relevant lines.
      <span class="green"><b>94</b> lines covered</span> and
      <span class="red"><b>2</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>26</b> total branches, </span>
          <span class="green"><b>23</b> branches covered</span> and
          <span class="red"><b>3</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">require &#39;tsort&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="5">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">module Piperb</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby">  # Directed Acyclic Graph implementation using Ruby&#39;s TSort.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            
              
            

            <code class="ruby">  # Manages step dependencies and provides topological sorting.</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="8">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  class DAG</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="9">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    include TSort</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="11">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def initialize</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="463" data-linenumber="12">
            
              <span class="hits">463</span>
            

            
              
            

            <code class="ruby">      @steps = {}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="15">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def add(step)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1382" data-linenumber="16">
            
              <span class="hits">1382</span>
            

            
              
                <span class="hits" title="then branch hit 5 times">
                  then: 5
                </span>
              
                <span class="hits" title="else branch hit 1377 times">
                  else: 1377
                </span>
              
            

            <code class="ruby">      if @steps.key?(step.name)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="17">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">        raise DuplicateStepError.new(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby">          &quot;Step &#39;#{step.name}&#39; already exists&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby">          step_name: step.name</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby">        )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1377" data-linenumber="23">
            
              <span class="hits">1377</span>
            

            
              
            

            <code class="ruby">      @steps[step.name] = step</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1377" data-linenumber="24">
            
              <span class="hits">1377</span>
            

            
              
            

            <code class="ruby">      self</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="27">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def [](name)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="28">
            
              <span class="hits">12</span>
            

            
              
            

            <code class="ruby">      @steps[name.to_sym]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="31">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def steps</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="32">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">      @steps.values</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="35">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def step_names</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="36">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      @steps.keys</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="39">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def empty?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="89" data-linenumber="40">
            
              <span class="hits">89</span>
            

            
              
            

            <code class="ruby">      @steps.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="43">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def size</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="44">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">      @steps.size</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="47">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def sorted_steps</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="392" data-linenumber="48">
            
              <span class="hits">392</span>
            

            
              
            

            <code class="ruby">      validate!</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1287" data-linenumber="49">
            
              <span class="hits">1287</span>
            

            
              
            

            <code class="ruby">      tsort.map { |name| @steps[name] }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="52">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def validate!</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="966" data-linenumber="53">
            
              <span class="hits">966</span>
            

            
              
            

            <code class="ruby">      validate_dependencies!</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="949" data-linenumber="54">
            
              <span class="hits">949</span>
            

            
              
            

            <code class="ruby">      validate_no_cycles!</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="924" data-linenumber="55">
            
              <span class="hits">924</span>
            

            
              
            

            <code class="ruby">      true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            

            
              
            

            <code class="ruby">    # Returns steps grouped by execution level.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            
              
            

            <code class="ruby">    # Steps at the same level have no dependencies on each other and can run in parallel.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            
              
            

            <code class="ruby">    # Level 0 contains steps with no dependencies (roots).</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            

            
              
            

            <code class="ruby">    # @return [Array&lt;Array&lt;Step&gt;&gt;] Array of step arrays, one per level</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="62">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def levels</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="71" data-linenumber="63">
            
              <span class="hits">71</span>
            

            
              
            

            <code class="ruby">      validate!</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="71" data-linenumber="64">
            
              <span class="hits">71</span>
            

            
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
                <span class="hits" title="else branch hit 69 times">
                  else: 69
                </span>
              
            

            <code class="ruby">      return [] if empty?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="69" data-linenumber="66">
            
              <span class="hits">69</span>
            

            
              
            

            <code class="ruby">      step_levels = compute_step_levels</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="69" data-linenumber="67">
            
              <span class="hits">69</span>
            

            
              
            

            <code class="ruby">      group_steps_by_level(step_levels)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="70">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def to_mermaid</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="71">
            
              <span class="hits">12</span>
            

            
              
            

            <code class="ruby">      lines = [&#39;graph TD&#39;]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="73">
            
              <span class="hits">12</span>
            

            
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
                <span class="hits" title="else branch hit 10 times">
                  else: 10
                </span>
              
            

            <code class="ruby">      if empty?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="74">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">        lines &lt;&lt; &#39;  empty[Empty Pipeline]&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="75">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">        return lines.join(&quot;\n&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="78">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">      sorted_steps.each do |step|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="26" data-linenumber="79">
            
              <span class="hits">26</span>
            

            
              
                <span class="hits" title="then branch hit 16 times">
                  then: 16
                </span>
              
            

            <code class="ruby">        if step.dependencies.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="80">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">          lines &lt;&lt; &quot;  #{step.name}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            

            
              
                <span class="hits" title="else branch hit 10 times">
                  else: 10
                </span>
              
            

            <code class="ruby">        else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="82">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">          step.dependencies.each do |dep|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="83">
            
              <span class="hits">13</span>
            

            
              
            

            <code class="ruby">            lines &lt;&lt; &quot;  #{dep} --&gt; #{step.name}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            

            
              
            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="87">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="88">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">      lines.join(&quot;\n&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="91">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="92">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="93">
            

            
              
            

            <code class="ruby">    # TSort interface: iterate over all nodes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="94">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def tsort_each_node(&amp;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1410" data-linenumber="95">
            
              <span class="hits">1410</span>
            

            
              
            

            <code class="ruby">      @steps.each_key(&amp;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="96">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="97">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="98">
            

            
              
            

            <code class="ruby">    # TSort interface: iterate over dependencies of a node</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="99">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def tsort_each_child(node, &amp;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4095" data-linenumber="100">
            
              <span class="hits">4095</span>
            

            
              
            

            <code class="ruby">      step = @steps[node]</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="4095" data-linenumber="101">
            
              <span class="hits">4095</span>
            

            
              
                <span class="hits" title="else branch hit 4095 times">
                  else: 4095
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">      return unless step</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="102">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4095" data-linenumber="103">
            
              <span class="hits">4095</span>
            

            
              
            

            <code class="ruby">      step.dependencies.each(&amp;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="104">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="105">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="106">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def compute_step_levels</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="69" data-linenumber="107">
            
              <span class="hits">69</span>
            

            
              
            

            <code class="ruby">      step_levels = {}</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="69" data-linenumber="108">
            
              <span class="hits">69</span>
            

            
              
            

            <code class="ruby">      tsort.each do |name|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="469" data-linenumber="109">
            
              <span class="hits">469</span>
            

            
              
            

            <code class="ruby">        step = @steps[name]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="738" data-linenumber="110">
            
              <span class="hits">738</span>
            

            
              
                <span class="hits" title="then branch hit 385 times">
                  then: 385
                </span>
              
                <span class="hits" title="else branch hit 84 times">
                  else: 84
                </span>
              
            

            <code class="ruby">        step_levels[name] = step.dependencies.empty? ? 0 : step.dependencies.map { |dep| step_levels[dep] }.max + 1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="111">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="69" data-linenumber="112">
            
              <span class="hits">69</span>
            

            
              
            

            <code class="ruby">      step_levels</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="113">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="114">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="115">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def group_steps_by_level(step_levels)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="69" data-linenumber="116">
            
              <span class="hits">69</span>
            

            
              
            

            <code class="ruby">      max_level = step_levels.values.max || 0</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1525" data-linenumber="117">
            
              <span class="hits">1525</span>
            

            
              
            

            <code class="ruby">      (0..max_level).map { |level| step_levels.select { |_, l| l == level }.keys.map { |name| @steps[name] } }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="118">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="119">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="120">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def validate_dependencies!</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="966" data-linenumber="121">
            
              <span class="hits">966</span>
            

            
              
            

            <code class="ruby">      @steps.each_value do |step|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2754" data-linenumber="122">
            
              <span class="hits">2754</span>
            

            
              
            

            <code class="ruby">        step.dependencies.each do |dep|</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="123">
            

            
              
            

            <code class="ruby">          # Check for self-reference</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1702" data-linenumber="124">
            
              <span class="hits">1702</span>
            

            
              
                <span class="hits" title="then branch hit 3 times">
                  then: 3
                </span>
              
                <span class="hits" title="else branch hit 1699 times">
                  else: 1699
                </span>
              
            

            <code class="ruby">          if dep == step.name</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="125">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">            raise CycleError.new(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="126">
            

            
              
            

            <code class="ruby">              &quot;Circular dependency detected: #{step.name} -&gt; #{step.name}&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="127">
            

            
              
            

            <code class="ruby">              cycle: [step.name, step.name]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="128">
            

            
              
            

            <code class="ruby">            )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="129">
            

            
              
            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="130">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1699" data-linenumber="131">
            
              <span class="hits">1699</span>
            

            
              
                <span class="hits" title="then branch hit 1685 times">
                  then: 1685
                </span>
              
                <span class="hits" title="else branch hit 14 times">
                  else: 14
                </span>
              
            

            <code class="ruby">          next if @steps.key?(dep)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="132">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="133">
            
              <span class="hits">14</span>
            

            
              
            

            <code class="ruby">          raise MissingDependencyError.new(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="134">
            

            
              
            

            <code class="ruby">            &quot;Step &#39;#{step.name}&#39; depends on &#39;#{dep}&#39; which does not exist&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="135">
            

            
              
            

            <code class="ruby">            step_name: step.name,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="136">
            

            
              
            

            <code class="ruby">            missing_dependency: dep</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="137">
            

            
              
            

            <code class="ruby">          )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="138">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="139">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="140">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="141">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="142">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def validate_no_cycles!</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="949" data-linenumber="143">
            
              <span class="hits">949</span>
            

            
              
            

            <code class="ruby">      tsort</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="144">
            

            
              
            

            <code class="ruby">    rescue TSort::Cyclic =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="145">
            

            
              
            

            <code class="ruby">      # Extract cycle information from the error message</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="25" data-linenumber="146">
            
              <span class="hits">25</span>
            

            
              
            

            <code class="ruby">      cycle = extract_cycle_from_error(e)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="25" data-linenumber="147">
            
              <span class="hits">25</span>
            

            
              
            

            <code class="ruby">      raise CycleError.new(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="148">
            

            
              
            

            <code class="ruby">        &quot;Circular dependency detected: #{cycle.join(&#39; -&gt; &#39;)}&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="149">
            

            
              
            

            <code class="ruby">        cycle: cycle</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="150">
            

            
              
            

            <code class="ruby">      )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="151">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="152">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="153">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def extract_cycle_from_error(_error)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="154">
            

            
              
            

            <code class="ruby">      # TSort::Cyclic message format: &quot;topological sort failed: ... (TSort::Cyclic)&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="155">
            

            
              
            

            <code class="ruby">      # Try to detect the cycle by finding strongly connected components</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="25" data-linenumber="156">
            
              <span class="hits">25</span>
            

            
              
            

            <code class="ruby">      detect_cycle</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="157">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="158">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="159">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def detect_cycle</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="160">
            

            
              
            

            <code class="ruby">      # Simple DFS-based cycle detection</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="25" data-linenumber="161">
            
              <span class="hits">25</span>
            

            
              
            

            <code class="ruby">      visited = {}</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="25" data-linenumber="162">
            
              <span class="hits">25</span>
            

            
              
            

            <code class="ruby">      rec_stack = {}</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="25" data-linenumber="163">
            
              <span class="hits">25</span>
            

            
              
            

            <code class="ruby">      cycle = []</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="164">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="25" data-linenumber="165">
            
              <span class="hits">25</span>
            

            
              
            

            <code class="ruby">      @steps.each_key do |name|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28" data-linenumber="166">
            
              <span class="hits">28</span>
            

            
              
                <span class="hits" title="then branch hit 25 times">
                  then: 25
                </span>
              
                <span class="hits" title="else branch hit 3 times">
                  else: 3
                </span>
              
            

            <code class="ruby">        return cycle.reverse if detect_cycle_dfs(name, visited, rec_stack, cycle)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="167">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="168">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="169">
            

            
              
            

            <code class="ruby">      []</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="170">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="171">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="172">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def detect_cycle_dfs(node, visited, rec_stack, cycle)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="61" data-linenumber="173">
            
              <span class="hits">61</span>
            

            
              
            

            <code class="ruby">      visited[node] = true</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="61" data-linenumber="174">
            
              <span class="hits">61</span>
            

            
              
            

            <code class="ruby">      rec_stack[node] = true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="175">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="61" data-linenumber="176">
            
              <span class="hits">61</span>
            

            
              
            

            <code class="ruby">      step = @steps[node]</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="61" data-linenumber="177">
            
              <span class="hits">61</span>
            

            
              
                <span class="hits" title="else branch hit 61 times">
                  else: 61
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">      return false unless step</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="178">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="61" data-linenumber="179">
            
              <span class="hits">61</span>
            

            
              
            

            <code class="ruby">      step.dependencies.each do |dep|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="61" data-linenumber="180">
            
              <span class="hits">61</span>
            

            
              
                <span class="hits" title="then branch hit 33 times">
                  then: 33
                </span>
              
            

            <code class="ruby">        if !visited[dep]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="33" data-linenumber="181">
            
              <span class="hits">33</span>
            

            
              
            

            <code class="ruby">          cycle &lt;&lt; node</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="33" data-linenumber="182">
            
              <span class="hits">33</span>
            

            
              
                <span class="hits" title="then branch hit 33 times">
                  then: 33
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">          return true if detect_cycle_dfs(dep, visited, rec_stack, cycle)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="183">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="184">
            

            
              
                <span class="hits" title="else branch hit 28 times">
                  else: 28
                </span>
              
            

            <code class="ruby">          cycle.pop</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28" data-linenumber="185">
            
              <span class="hits">28</span>
            

            
              
                <span class="hits" title="then branch hit 25 times">
                  then: 25
                </span>
              
                <span class="hits" title="else branch hit 3 times">
                  else: 3
                </span>
              
            

            <code class="ruby">        elsif rec_stack[dep]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="25" data-linenumber="186">
            
              <span class="hits">25</span>
            

            
              
            

            <code class="ruby">          cycle &lt;&lt; node</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="25" data-linenumber="187">
            
              <span class="hits">25</span>
            

            
              
            

            <code class="ruby">          cycle &lt;&lt; dep</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="25" data-linenumber="188">
            
              <span class="hits">25</span>
            

            
              
            

            <code class="ruby">          return true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="189">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="190">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="191">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="192">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      rec_stack[node] = false</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="193">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      false</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="194">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="195">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="196">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="71463d1030d09ce814e27aaa6f3d8659aa5c4504">
  <div class="header">
    <h3>lib/piperb/errors.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>32</b> relevant lines.
      <span class="green"><b>32</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>0</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">module Piperb</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby">  # Base error class for all Piperb errors</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="5">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  class Error &lt; StandardError; end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            
              
            

            <code class="ruby">  # Raised when a circular dependency is detected in the DAG</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="8">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  class CycleError &lt; Error</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="9">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    attr_reader :cycle</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="11">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def initialize(message = &#39;Circular dependency detected&#39;, cycle: nil)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="30" data-linenumber="12">
            
              <span class="hits">30</span>
            

            
              
            

            <code class="ruby">      @cycle = cycle</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="30" data-linenumber="13">
            
              <span class="hits">30</span>
            

            
              
            

            <code class="ruby">      super(message)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby">  # Raised when a step references a dependency that doesn&#39;t exist</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="18">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  class MissingDependencyError &lt; Error</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="19">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    attr_reader :step_name, :missing_dependency</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="21">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def initialize(message = &#39;Missing dependency&#39;, step_name: nil, missing_dependency: nil)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="22">
            
              <span class="hits">15</span>
            

            
              
            

            <code class="ruby">      @step_name = step_name</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="23">
            
              <span class="hits">15</span>
            

            
              
            

            <code class="ruby">      @missing_dependency = missing_dependency</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="24">
            
              <span class="hits">15</span>
            

            
              
            

            <code class="ruby">      super(message)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby">  # Raised when a step with the same name already exists</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="29">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  class DuplicateStepError &lt; Error</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="30">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    attr_reader :step_name</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="32">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def initialize(message = &#39;Duplicate step&#39;, step_name: nil)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="33">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">      @step_name = step_name</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="34">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">      super(message)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby">  # Raised when a step execution fails</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="39">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  class StepError &lt; Error</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="40">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    attr_reader :step_name, :original_error, :partial_results</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="42">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def initialize(message = &#39;Step execution failed&#39;, step_name: nil, original_error: nil, partial_results: nil)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="70" data-linenumber="43">
            
              <span class="hits">70</span>
            

            
              
            

            <code class="ruby">      @step_name = step_name</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="70" data-linenumber="44">
            
              <span class="hits">70</span>
            

            
              
            

            <code class="ruby">      @original_error = original_error</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="70" data-linenumber="45">
            
              <span class="hits">70</span>
            

            
              
            

            <code class="ruby">      @partial_results = partial_results</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="70" data-linenumber="46">
            
              <span class="hits">70</span>
            

            
              
            

            <code class="ruby">      super(message)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            
              
            

            <code class="ruby">  # Raised when a step exceeds its timeout</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="51">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  class TimeoutError &lt; Error</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="52">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    attr_reader :step_name, :timeout_seconds</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="54">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def initialize(message = nil, step_name: nil, timeout_seconds: nil)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="36" data-linenumber="55">
            
              <span class="hits">36</span>
            

            
              
            

            <code class="ruby">      @step_name = step_name</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="36" data-linenumber="56">
            
              <span class="hits">36</span>
            

            
              
            

            <code class="ruby">      @timeout_seconds = timeout_seconds</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="36" data-linenumber="57">
            
              <span class="hits">36</span>
            

            
              
            

            <code class="ruby">      message ||= &quot;Step &#39;#{step_name}&#39; timed out after #{timeout_seconds} seconds&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="36" data-linenumber="58">
            
              <span class="hits">36</span>
            

            
              
            

            <code class="ruby">      super(message)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="08b7564565af4050dc638d634122a0aad64f0c3c">
  <div class="header">
    <h3>lib/piperb/executor/base.rb</h3>
    <h4>
      <span class="green">
  99.11%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  94.44%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>112</b> relevant lines.
      <span class="green"><b>111</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>54</b> total branches, </span>
          <span class="green"><b>51</b> branches covered</span> and
          <span class="red"><b>3</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">require &#39;timeout&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="5">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">module Piperb</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="6">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  module Executor</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            
              
            

            <code class="ruby">    # Abstract base class for pipeline executors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby">    # Subclasses must implement the #execute method.</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="9">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    class Base # rubocop:disable Metrics/ClassLength</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="10">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      attr_reader :dag</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="12">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def initialize(dag)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="443" data-linenumber="13">
            
              <span class="hits">443</span>
            

            
              
            

            <code class="ruby">        @dag = dag</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="16">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def execute(initial_input: nil)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="17">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        raise NotImplementedError, &#39;Subclasses must implement #execute&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="20">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      protected</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="22">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def build_step_input(step, outputs, initial_input)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1235" data-linenumber="23">
            
              <span class="hits">1235</span>
            

            
              
            

            <code class="ruby">        deps = step.dependencies</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1235" data-linenumber="25">
            
              <span class="hits">1235</span>
            

            
              
            

            <code class="ruby">        case deps.size</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby">        when 0</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
                <span class="hits" title="when branch hit 794 times">
                  when: 794
                </span>
              
            

            <code class="ruby">          # No dependencies: pass initial input or empty args</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="794" data-linenumber="28">
            
              <span class="hits">794</span>
            

            
              
                <span class="hits" title="then branch hit 756 times">
                  then: 756
                </span>
              
                <span class="hits" title="else branch hit 38 times">
                  else: 38
                </span>
              
            

            <code class="ruby">          { args: initial_input.nil? ? [] : [initial_input], kwargs: {} }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby">        when 1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
                <span class="hits" title="when branch hit 348 times">
                  when: 348
                </span>
              
            

            <code class="ruby">          # Single dependency: pass output directly</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="348" data-linenumber="31">
            
              <span class="hits">348</span>
            

            
              
            

            <code class="ruby">          { args: [outputs[deps.first]], kwargs: {} }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby">        else</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
                <span class="hits" title="else branch hit 93 times">
                  else: 93
                </span>
              
            

            <code class="ruby">          # Multiple dependencies: pass as keyword arguments</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="93" data-linenumber="34">
            
              <span class="hits">93</span>
            

            
              
            

            <code class="ruby">          kwargs = deps.each_with_object({}) do |dep, hash|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="379" data-linenumber="35">
            
              <span class="hits">379</span>
            

            
              
            

            <code class="ruby">            hash[dep] = outputs[dep]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="93" data-linenumber="37">
            
              <span class="hits">93</span>
            

            
              
            

            <code class="ruby">          { args: [], kwargs: kwargs }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby">      # Executes a step with retry and timeout support</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="42">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def execute_step_with_retry(step, input)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1115" data-linenumber="43">
            
              <span class="hits">1115</span>
            

            
              
            

            <code class="ruby">        retries_remaining = step.retries</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1115" data-linenumber="44">
            
              <span class="hits">1115</span>
            

            
              
            

            <code class="ruby">        retry_count = 0</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1115" data-linenumber="45">
            
              <span class="hits">1115</span>
            

            
              
            

            <code class="ruby">        last_error = nil</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1115" data-linenumber="46">
            
              <span class="hits">1115</span>
            

            
              
            

            <code class="ruby">        timed_out = false</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1115" data-linenumber="47">
            
              <span class="hits">1115</span>
            

            
              
            

            <code class="ruby">        step_started_at = Time.now</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1115" data-linenumber="49">
            
              <span class="hits">1115</span>
            

            
              
            

            <code class="ruby">        loop do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1208" data-linenumber="50">
            
              <span class="hits">1208</span>
            

            
              
            

            <code class="ruby">          result = execute_single_attempt(step, input)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1208" data-linenumber="52">
            
              <span class="hits">1208</span>
            

            
              
                <span class="hits" title="then branch hit 1041 times">
                  then: 1041
                </span>
              
                <span class="hits" title="else branch hit 167 times">
                  else: 167
                </span>
              
            

            <code class="ruby">          return build_success_result(step, result[:output], step_started_at, retry_count) if result[:success]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="167" data-linenumber="54">
            
              <span class="hits">167</span>
            

            
              
            

            <code class="ruby">          last_error = result[:error]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="167" data-linenumber="55">
            
              <span class="hits">167</span>
            

            
              
            

            <code class="ruby">          timed_out = result[:timed_out]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="167" data-linenumber="57">
            
              <span class="hits">167</span>
            

            
              
                <span class="hits" title="else branch hit 93 times">
                  else: 93
                </span>
              
                <span class="hits" title="then branch hit 73 times">
                  then: 73
                </span>
              
            

            <code class="ruby">          break unless should_retry?(step, last_error, retries_remaining)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="93" data-linenumber="59">
            
              <span class="hits">93</span>
            

            
              
            

            <code class="ruby">          retries_remaining -= 1</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="93" data-linenumber="60">
            
              <span class="hits">93</span>
            

            
              
            

            <code class="ruby">          retry_count += 1</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="93" data-linenumber="61">
            
              <span class="hits">93</span>
            

            
              
            

            <code class="ruby">          apply_retry_delay(step, retry_count)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="73" data-linenumber="64">
            
              <span class="hits">73</span>
            

            
              
            

            <code class="ruby">        build_failure_result(step, last_error, step_started_at, retry_count, timed_out)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="67">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="69">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def execute_single_attempt(step, input)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1208" data-linenumber="70">
            
              <span class="hits">1208</span>
            

            
              
                <span class="hits" title="then branch hit 54 times">
                  then: 54
                </span>
              
            

            <code class="ruby">        if step.timeout</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="54" data-linenumber="71">
            
              <span class="hits">54</span>
            

            
              
            

            <code class="ruby">          execute_with_timeout(step, input)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            

            
              
                <span class="hits" title="else branch hit 1154 times">
                  else: 1154
                </span>
              
            

            <code class="ruby">        else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1154" data-linenumber="73">
            
              <span class="hits">1154</span>
            

            
              
            

            <code class="ruby">          execute_without_timeout(step, input)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="77">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def execute_with_timeout(step, input)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="54" data-linenumber="78">
            
              <span class="hits">54</span>
            

            
              
            

            <code class="ruby">        output = Timeout.timeout(step.timeout) do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="54" data-linenumber="79">
            
              <span class="hits">54</span>
            

            
              
            

            <code class="ruby">          step.call(*input[:args], **input[:kwargs])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="81">
            
              <span class="hits">15</span>
            

            
              
            

            <code class="ruby">        { success: true, output: output }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            

            
              
            

            <code class="ruby">      rescue Timeout::Error</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="36" data-linenumber="83">
            
              <span class="hits">36</span>
            

            
              
            

            <code class="ruby">        error = TimeoutError.new(step_name: step.name, timeout_seconds: step.timeout)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="36" data-linenumber="84">
            
              <span class="hits">36</span>
            

            
              
            

            <code class="ruby">        { success: false, error: error, timed_out: true }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            

            
              
            

            <code class="ruby">      rescue StandardError =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="86">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">        { success: false, error: e, timed_out: false }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="87">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="89">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def execute_without_timeout(step, input)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1154" data-linenumber="90">
            
              <span class="hits">1154</span>
            

            
              
            

            <code class="ruby">        output = step.call(*input[:args], **input[:kwargs])</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1026" data-linenumber="91">
            
              <span class="hits">1026</span>
            

            
              
            

            <code class="ruby">        { success: true, output: output }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="92">
            

            
              
            

            <code class="ruby">      rescue StandardError =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="128" data-linenumber="93">
            
              <span class="hits">128</span>
            

            
              
            

            <code class="ruby">        { success: false, error: e, timed_out: false }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="96">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def should_retry?(step, error, retries_remaining)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="167" data-linenumber="97">
            
              <span class="hits">167</span>
            

            
              
                <span class="hits" title="then branch hit 70 times">
                  then: 70
                </span>
              
                <span class="hits" title="else branch hit 97 times">
                  else: 97
                </span>
              
            

            <code class="ruby">        return false if retries_remaining &lt;= 0</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="98">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="97" data-linenumber="99">
            
              <span class="hits">97</span>
            

            
              
            

            <code class="ruby">        retry_condition = step.retry_if</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="97" data-linenumber="100">
            
              <span class="hits">97</span>
            

            
              
                <span class="hits" title="else branch hit 11 times">
                  else: 11
                </span>
              
                <span class="hits" title="then branch hit 86 times">
                  then: 86
                </span>
              
            

            <code class="ruby">        return true unless retry_condition</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="101">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="102">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">        retry_condition.call(error)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="103">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="104">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="105">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def apply_retry_delay(step, retry_count)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="93" data-linenumber="106">
            
              <span class="hits">93</span>
            

            
              
            

            <code class="ruby">        base_delay = step.retry_delay</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="93" data-linenumber="107">
            
              <span class="hits">93</span>
            

            
              
                <span class="hits" title="then branch hit 71 times">
                  then: 71
                </span>
              
                <span class="hits" title="else branch hit 22 times">
                  else: 22
                </span>
              
            

            <code class="ruby">        return if base_delay.nil? || base_delay &lt;= 0</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="108">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22" data-linenumber="109">
            
              <span class="hits">22</span>
            

            
              
            

            <code class="ruby">        actual_delay = calculate_delay(base_delay, retry_count, step.retry_backoff)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22" data-linenumber="110">
            
              <span class="hits">22</span>
            

            
              
            

            <code class="ruby">        sleep(actual_delay)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="111">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="112">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="113">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def calculate_delay(base_delay, retry_count, backoff)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22" data-linenumber="114">
            
              <span class="hits">22</span>
            

            
              
            

            <code class="ruby">        case backoff</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="115">
            

            
              
                <span class="hits" title="when branch hit 6 times">
                  when: 6
                </span>
              
            

            <code class="ruby">        when :exponential</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="116">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">          base_delay * (2**(retry_count - 1))</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="117">
            

            
              
                <span class="hits" title="when branch hit 6 times">
                  when: 6
                </span>
              
            

            <code class="ruby">        when :linear</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="118">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">          base_delay * retry_count</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="119">
            

            
              
                <span class="hits" title="else branch hit 10 times">
                  else: 10
                </span>
              
            

            <code class="ruby">        else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="120">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">          base_delay</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="121">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="122">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="123">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="124">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def build_success_result(step, output, started_at, retry_count)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1041" data-linenumber="125">
            
              <span class="hits">1041</span>
            

            
              
            

            <code class="ruby">        StepResult.new(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="126">
            

            
              
            

            <code class="ruby">          step_name: step.name,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="127">
            

            
              
            

            <code class="ruby">          output: output,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="128">
            

            
              
            

            <code class="ruby">          duration: Time.now - started_at,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="129">
            

            
              
            

            <code class="ruby">          started_at: started_at,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="130">
            

            
              
            

            <code class="ruby">          status: :success,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="131">
            

            
              
            

            <code class="ruby">          retries: retry_count</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="132">
            

            
              
            

            <code class="ruby">        )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="133">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="134">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="135">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def build_failure_result(step, error, started_at, retry_count, timed_out)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="73" data-linenumber="136">
            
              <span class="hits">73</span>
            

            
              
            

            <code class="ruby">        StepResult.new(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="137">
            

            
              
            

            <code class="ruby">          step_name: step.name,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="138">
            

            
              
            

            <code class="ruby">          error: error,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="139">
            

            
              
            

            <code class="ruby">          duration: Time.now - started_at,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="140">
            

            
              
            

            <code class="ruby">          started_at: started_at,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="141">
            

            
              
            

            <code class="ruby">          status: :failed,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="142">
            

            
              
            

            <code class="ruby">          retries: retry_count,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="143">
            

            
              
            

            <code class="ruby">          timed_out: timed_out</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="144">
            

            
              
            

            <code class="ruby">        )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="145">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="146">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="147">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def build_skipped_result(step)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="64" data-linenumber="148">
            
              <span class="hits">64</span>
            

            
              
            

            <code class="ruby">        StepResult.new(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="149">
            

            
              
            

            <code class="ruby">          step_name: step.name,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="150">
            

            
              
            

            <code class="ruby">          output: nil,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="151">
            

            
              
            

            <code class="ruby">          duration: 0,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="152">
            

            
              
            

            <code class="ruby">          started_at: Time.now,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="153">
            

            
              
            

            <code class="ruby">          status: :skipped,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="154">
            

            
              
            

            <code class="ruby">          retries: 0</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="155">
            

            
              
            

            <code class="ruby">        )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="156">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="157">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="158">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def should_skip_step?(step, input)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1177" data-linenumber="159">
            
              <span class="hits">1177</span>
            

            
              
                <span class="hits" title="else branch hit 117 times">
                  else: 117
                </span>
              
                <span class="hits" title="then branch hit 1060 times">
                  then: 1060
                </span>
              
            

            <code class="ruby">        return false unless step.conditional?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="160">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="117" data-linenumber="161">
            
              <span class="hits">117</span>
            

            
              
            

            <code class="ruby">        if_cond = step.if_condition</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="117" data-linenumber="162">
            
              <span class="hits">117</span>
            

            
              
            

            <code class="ruby">        unless_cond = step.unless_condition</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="163">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="164">
            

            
              
            

            <code class="ruby">        # if: takes precedence when both are present</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="117" data-linenumber="165">
            
              <span class="hits">117</span>
            

            
              
                <span class="hits" title="then branch hit 111 times">
                  then: 111
                </span>
              
                <span class="hits" title="else branch hit 6 times">
                  else: 6
                </span>
              
            

            <code class="ruby">        return !evaluate_condition(if_cond, input) if if_cond</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="166">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="6" data-linenumber="167">
            
              <span class="hits">6</span>
            

            
              
                <span class="hits" title="then branch hit 6 times">
                  then: 6
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">        return evaluate_condition(unless_cond, input) if unless_cond</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="168">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="169">
            

            
              
            

            <code class="ruby">        false</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="170">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="171">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="172">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def evaluate_condition(condition, input)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="117" data-linenumber="173">
            
              <span class="hits">117</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 117 times">
                  else: 117
                </span>
              
            

            <code class="ruby">        return true if condition.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="174">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="117" data-linenumber="175">
            
              <span class="hits">117</span>
            

            
              
                <span class="hits" title="then branch hit 111 times">
                  then: 111
                </span>
              
            

            <code class="ruby">        if input[:kwargs].empty?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="111" data-linenumber="176">
            
              <span class="hits">111</span>
            

            
              
                <span class="hits" title="then branch hit 35 times">
                  then: 35
                </span>
              
            

            <code class="ruby">          if input[:args].empty?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="35" data-linenumber="177">
            
              <span class="hits">35</span>
            

            
              
            

            <code class="ruby">            condition.call</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="178">
            

            
              
                <span class="hits" title="else branch hit 76 times">
                  else: 76
                </span>
              
            

            <code class="ruby">          else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="76" data-linenumber="179">
            
              <span class="hits">76</span>
            

            
              
            

            <code class="ruby">            condition.call(*input[:args])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="180">
            

            
              
            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="181">
            

            
              
                <span class="hits" title="else branch hit 6 times">
                  else: 6
                </span>
              
            

            <code class="ruby">        else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="182">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">          condition.call(**input[:kwargs])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="183">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="184">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="185">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="186">
            

            
              
            

            <code class="ruby">      # Cache support methods</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="187">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def cache_key_for(step, input)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="254" data-linenumber="188">
            
              <span class="hits">254</span>
            

            
              
            

            <code class="ruby">        custom_key = step.cache_key</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="254" data-linenumber="189">
            
              <span class="hits">254</span>
            

            
              
                <span class="hits" title="then branch hit 53 times">
                  then: 53
                </span>
              
            

            <code class="ruby">        if custom_key</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="53" data-linenumber="190">
            
              <span class="hits">53</span>
            

            
              
                <span class="hits" title="then branch hit 50 times">
                  then: 50
                </span>
              
            

            <code class="ruby">          if input[:kwargs].empty?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="50" data-linenumber="191">
            
              <span class="hits">50</span>
            

            
              
            

            <code class="ruby">            custom_key.call(*input[:args])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="192">
            

            
              
                <span class="hits" title="else branch hit 3 times">
                  else: 3
                </span>
              
            

            <code class="ruby">          else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="193">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">            custom_key.call(**input[:kwargs])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="194">
            

            
              
            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="195">
            

            
              
                <span class="hits" title="else branch hit 201 times">
                  else: 201
                </span>
              
            

            <code class="ruby">        else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="201" data-linenumber="196">
            
              <span class="hits">201</span>
            

            
              
            

            <code class="ruby">          step.name.to_s</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="197">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="198">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="199">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="200">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def check_cache(step, input, cache, force)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1235" data-linenumber="201">
            
              <span class="hits">1235</span>
            

            
              
                <span class="hits" title="else branch hit 161 times">
                  else: 161
                </span>
              
                <span class="hits" title="then branch hit 1074 times">
                  then: 1074
                </span>
              
            

            <code class="ruby">        return nil unless cache</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="161" data-linenumber="202">
            
              <span class="hits">161</span>
            

            
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
                <span class="hits" title="else branch hit 159 times">
                  else: 159
                </span>
              
            

            <code class="ruby">        return nil if force</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="159" data-linenumber="203">
            
              <span class="hits">159</span>
            

            
              
                <span class="hits" title="else branch hit 157 times">
                  else: 157
                </span>
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
            

            <code class="ruby">        return nil unless step.cache_enabled?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="204">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="157" data-linenumber="205">
            
              <span class="hits">157</span>
            

            
              
            

            <code class="ruby">        key = cache_key_for(step, input)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="157" data-linenumber="206">
            
              <span class="hits">157</span>
            

            
              
                <span class="hits" title="else branch hit 58 times">
                  else: 58
                </span>
              
                <span class="hits" title="then branch hit 99 times">
                  then: 99
                </span>
              
            

            <code class="ruby">        return nil unless cache.exist?(key)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="207">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="58" data-linenumber="208">
            
              <span class="hits">58</span>
            

            
              
            

            <code class="ruby">        cached = cache.read(key)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="58" data-linenumber="209">
            
              <span class="hits">58</span>
            

            
              
                <span class="hits" title="else branch hit 58 times">
                  else: 58
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">        return nil unless cached.is_a?(Cache::CachedResult)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="210">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="58" data-linenumber="211">
            
              <span class="hits">58</span>
            

            
              
            

            <code class="ruby">        build_cached_result(step, cached)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="212">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="213">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="214">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def write_cache(step, result, input, cache)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1175" data-linenumber="215">
            
              <span class="hits">1175</span>
            

            
              
                <span class="hits" title="else branch hit 103 times">
                  else: 103
                </span>
              
                <span class="hits" title="then branch hit 1072 times">
                  then: 1072
                </span>
              
            

            <code class="ruby">        return unless cache</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="103" data-linenumber="216">
            
              <span class="hits">103</span>
            

            
              
                <span class="hits" title="else branch hit 101 times">
                  else: 101
                </span>
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
            

            <code class="ruby">        return unless step.cache_enabled?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="101" data-linenumber="217">
            
              <span class="hits">101</span>
            

            
              
                <span class="hits" title="then branch hit 4 times">
                  then: 4
                </span>
              
                <span class="hits" title="else branch hit 97 times">
                  else: 97
                </span>
              
            

            <code class="ruby">        return if result.failed?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="218">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="97" data-linenumber="219">
            
              <span class="hits">97</span>
            

            
              
            

            <code class="ruby">        key = cache_key_for(step, input)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="97" data-linenumber="220">
            
              <span class="hits">97</span>
            

            
              
            

            <code class="ruby">        cached = Cache::CachedResult.new(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="221">
            

            
              
            

            <code class="ruby">          output: result.output,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="222">
            

            
              
            

            <code class="ruby">          status: result.status,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="223">
            

            
              
            

            <code class="ruby">          skipped: result.skipped?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="224">
            

            
              
            

            <code class="ruby">        )</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="97" data-linenumber="225">
            
              <span class="hits">97</span>
            

            
              
            

            <code class="ruby">        cache.write(key, cached)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="226">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="227">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="228">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def build_cached_result(step, cached)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="58" data-linenumber="229">
            
              <span class="hits">58</span>
            

            
              
                <span class="hits" title="then branch hit 3 times">
                  then: 3
                </span>
              
            

            <code class="ruby">        if cached.skipped?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="230">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">          build_skipped_result(step)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="231">
            

            
              
                <span class="hits" title="else branch hit 55 times">
                  else: 55
                </span>
              
            

            <code class="ruby">        else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="55" data-linenumber="232">
            
              <span class="hits">55</span>
            

            
              
            

            <code class="ruby">          StepResult.new(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="233">
            

            
              
            

            <code class="ruby">            step_name: step.name,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="234">
            

            
              
            

            <code class="ruby">            output: cached.output,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="235">
            

            
              
            

            <code class="ruby">            duration: 0,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="236">
            

            
              
            

            <code class="ruby">            started_at: Time.now,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="237">
            

            
              
            

            <code class="ruby">            status: cached.status,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="238">
            

            
              
            

            <code class="ruby">            retries: 0</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="239">
            

            
              
            

            <code class="ruby">          )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="240">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="241">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="242">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="243">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="244">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="dde360fa7a8023b58621faf3d37b5eb5a4a0bd3f">
  <div class="header">
    <h3>lib/piperb/executor/parallel.rb</h3>
    <h4>
      <span class="green">
  98.51%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  93.75%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>67</b> relevant lines.
      <span class="green"><b>66</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>16</b> total branches, </span>
          <span class="green"><b>15</b> branches covered</span> and
          <span class="red"><b>1</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">require_relative &#39;base&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="5">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">module Piperb</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="6">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  module Executor</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            
              
            

            <code class="ruby">    # Executes pipeline steps in parallel where possible.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby">    # Steps at the same level (no inter-dependencies) run concurrently.</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="9">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    class Parallel &lt; Base</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="10">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def initialize(dag, max_threads: nil)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="65" data-linenumber="11">
            
              <span class="hits">65</span>
            

            
              
            

            <code class="ruby">        super(dag)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="65" data-linenumber="12">
            
              <span class="hits">65</span>
            

            
              
            

            <code class="ruby">        @max_threads = max_threads</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="15">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def execute(initial_input: nil, cache: nil, force: false)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="65" data-linenumber="16">
            
              <span class="hits">65</span>
            

            
              
            

            <code class="ruby">        dag.validate!</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="65" data-linenumber="17">
            
              <span class="hits">65</span>
            

            
              
            

            <code class="ruby">        context = ExecutionContext.new(initial_input, cache, force)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="65" data-linenumber="19">
            
              <span class="hits">65</span>
            

            
              
            

            <code class="ruby">        dag.levels.each do |level_steps|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="115" data-linenumber="20">
            
              <span class="hits">115</span>
            

            
              
                <span class="hits" title="then branch hit 3 times">
                  then: 3
                </span>
              
                <span class="hits" title="else branch hit 112 times">
                  else: 112
                </span>
              
            

            <code class="ruby">          break if context.error_info</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="133" data-linenumber="22">
            
              <span class="hits">133</span>
            

            
              
            

            <code class="ruby">          execute_level(level_steps, context) { |err| context.error_info = err }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="65" data-linenumber="25">
            
              <span class="hits">65</span>
            

            
              
            

            <code class="ruby">        context.finalize_result</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby">      rescue StepError</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="27">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">        raise</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby">      rescue StandardError =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="29">
            

            
              
            

            <code class="ruby">        Result.new(step_results: context.step_results, started_at: context.started_at, finished_at: Time.now, error: e)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="32">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby">      # Holds mutable state during parallel execution</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="35">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      class ExecutionContext</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="36">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        attr_reader :step_results, :outputs, :mutex, :started_at, :initial_input, :cache, :force</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="37">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        attr_accessor :error_info</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="39">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def initialize(initial_input, cache, force)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="65" data-linenumber="40">
            
              <span class="hits">65</span>
            

            
              
            

            <code class="ruby">          @initial_input = initial_input</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="65" data-linenumber="41">
            
              <span class="hits">65</span>
            

            
              
            

            <code class="ruby">          @cache = cache</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="65" data-linenumber="42">
            
              <span class="hits">65</span>
            

            
              
            

            <code class="ruby">          @force = force</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="65" data-linenumber="43">
            
              <span class="hits">65</span>
            

            
              
            

            <code class="ruby">          @started_at = Time.now</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="65" data-linenumber="44">
            
              <span class="hits">65</span>
            

            
              
            

            <code class="ruby">          @step_results = {}</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="65" data-linenumber="45">
            
              <span class="hits">65</span>
            

            
              
            

            <code class="ruby">          @outputs = {}</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="65" data-linenumber="46">
            
              <span class="hits">65</span>
            

            
              
            

            <code class="ruby">          @mutex = Mutex.new</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="65" data-linenumber="47">
            
              <span class="hits">65</span>
            

            
              
            

            <code class="ruby">          @error_info = nil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="50">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def finalize_result</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="65" data-linenumber="51">
            
              <span class="hits">65</span>
            

            
              
                <span class="hits" title="then branch hit 17 times">
                  then: 17
                </span>
              
                <span class="hits" title="else branch hit 48 times">
                  else: 48
                </span>
              
            

            <code class="ruby">          raise_step_error if error_info</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="48" data-linenumber="52">
            
              <span class="hits">48</span>
            

            
              
            

            <code class="ruby">          Result.new(step_results: step_results, started_at: started_at, finished_at: Time.now)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="55">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="57">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def raise_step_error</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="58">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">          raise StepError.new(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            
              
            

            <code class="ruby">            &quot;Step &#39;#{error_info[:step_name]}&#39; failed: #{error_info[:error].message}&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            
              
            

            <code class="ruby">            step_name: error_info[:step_name],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            

            
              
            

            <code class="ruby">            original_error: error_info[:error],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            
              
            

            <code class="ruby">            partial_results: Result.new(step_results: step_results, started_at: started_at, finished_at: Time.now)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            
              
            

            <code class="ruby">          )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="67">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def execute_level(steps, context, &amp;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="112" data-linenumber="68">
            
              <span class="hits">112</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 112 times">
                  else: 112
                </span>
              
            

            <code class="ruby">        return if context.error_info</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="112" data-linenumber="70">
            
              <span class="hits">112</span>
            

            
              
                <span class="hits" title="then branch hit 5 times">
                  then: 5
                </span>
              
                <span class="hits" title="else branch hit 107 times">
                  else: 107
                </span>
              
                <span class="hits" title="then branch hit 5 times">
                  then: 5
                </span>
              
            

            <code class="ruby">        if @max_threads&amp;.positive?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="71">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">          execute_batched(steps, context, &amp;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            

            
              
                <span class="hits" title="else branch hit 107 times">
                  else: 107
                </span>
              
            

            <code class="ruby">        else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="107" data-linenumber="73">
            
              <span class="hits">107</span>
            

            
              
            

            <code class="ruby">          execute_unbounded(steps, context, &amp;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="77">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def execute_batched(steps, context, &amp;error_handler)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="78">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">        steps.each_slice(@max_threads) do |batch|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="79">
            
              <span class="hits">20</span>
            

            
              
            

            <code class="ruby">          run_threads(batch, context, &amp;error_handler)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="83">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def execute_unbounded(steps, context, &amp;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="107" data-linenumber="84">
            
              <span class="hits">107</span>
            

            
              
            

            <code class="ruby">        run_threads(steps, context, &amp;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="87">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def run_threads(steps, context, &amp;error_handler)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="571" data-linenumber="88">
            
              <span class="hits">571</span>
            

            
              
            

            <code class="ruby">        threads = steps.map { |step| create_step_thread(step, context, &amp;error_handler) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="127" data-linenumber="89">
            
              <span class="hits">127</span>
            

            
              
            

            <code class="ruby">        threads.each(&amp;:join)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="92">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def create_step_thread(step, context)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="444" data-linenumber="93">
            
              <span class="hits">444</span>
            

            
              
            

            <code class="ruby">        Thread.new do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="444" data-linenumber="94">
            
              <span class="hits">444</span>
            

            
              
            

            <code class="ruby">          step_result = execute_step(step, context)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="444" data-linenumber="95">
            
              <span class="hits">444</span>
            

            
              
            

            <code class="ruby">          context.mutex.synchronize do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="444" data-linenumber="96">
            
              <span class="hits">444</span>
            

            
              
            

            <code class="ruby">            context.step_results[step.name] = step_result</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="444" data-linenumber="97">
            
              <span class="hits">444</span>
            

            
              
                <span class="hits" title="then branch hit 21 times">
                  then: 21
                </span>
              
            

            <code class="ruby">            if step_result.failed?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="21" data-linenumber="98">
            
              <span class="hits">21</span>
            

            
              
            

            <code class="ruby">              yield({ step_name: step.name, error: step_result.error })</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="99">
            

            
              
                <span class="hits" title="else branch hit 423 times">
                  else: 423
                </span>
              
            

            <code class="ruby">            else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="423" data-linenumber="100">
            
              <span class="hits">423</span>
            

            
              
            

            <code class="ruby">              context.outputs[step.name] = step_result.output</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="101">
            

            
              
            

            <code class="ruby">            end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="102">
            

            
              
            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="103">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="104">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="105">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="106">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def execute_step(step, context)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="888" data-linenumber="107">
            
              <span class="hits">888</span>
            

            
              
            

            <code class="ruby">        input = context.mutex.synchronize { build_step_input(step, context.outputs, context.initial_input) }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="108">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="109">
            

            
              
            

            <code class="ruby">        # Check cache first</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="444" data-linenumber="110">
            
              <span class="hits">444</span>
            

            
              
            

            <code class="ruby">        cached_result = check_cache(step, input, context.cache, context.force)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="444" data-linenumber="111">
            
              <span class="hits">444</span>
            

            
              
                <span class="hits" title="then branch hit 3 times">
                  then: 3
                </span>
              
                <span class="hits" title="else branch hit 441 times">
                  else: 441
                </span>
              
            

            <code class="ruby">        return cached_result if cached_result</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="112">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="113">
            

            
              
            

            <code class="ruby">        # Check conditions</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="441" data-linenumber="114">
            
              <span class="hits">441</span>
            

            
              
                <span class="hits" title="then branch hit 3 times">
                  then: 3
                </span>
              
                <span class="hits" title="else branch hit 438 times">
                  else: 438
                </span>
              
            

            <code class="ruby">        if should_skip_step?(step, input)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="115">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">          result = build_skipped_result(step)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="116">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">          context.mutex.synchronize { write_cache(step, result, input, context.cache) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="117">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">          return result</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="118">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="119">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="120">
            

            
              
            

            <code class="ruby">        # Execute and cache result</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="438" data-linenumber="121">
            
              <span class="hits">438</span>
            

            
              
            

            <code class="ruby">        result = execute_step_with_retry(step, input)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="876" data-linenumber="122">
            
              <span class="hits">876</span>
            

            
              
            

            <code class="ruby">        context.mutex.synchronize { write_cache(step, result, input, context.cache) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="438" data-linenumber="123">
            
              <span class="hits">438</span>
            

            
              
            

            <code class="ruby">        result</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="124">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="125">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="126">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="127">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="5fb4052aa1599a0e4a15e928eaeb1cae48b5fecd">
  <div class="header">
    <h3>lib/piperb/executor/sequential.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>34</b> relevant lines.
      <span class="green"><b>34</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>6</b> total branches, </span>
          <span class="green"><b>6</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">require_relative &#39;base&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="5">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">module Piperb</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="6">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  module Executor</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            
              
            

            <code class="ruby">    # Executes pipeline steps sequentially in topological order.</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="8">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    class Sequential &lt; Base</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="9">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def execute(initial_input: nil, cache: nil, force: false) # rubocop:disable Metrics/MethodLength</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="377" data-linenumber="10">
            
              <span class="hits">377</span>
            

            
              
            

            <code class="ruby">        dag.validate!</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="369" data-linenumber="12">
            
              <span class="hits">369</span>
            

            
              
            

            <code class="ruby">        @cache = cache</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="369" data-linenumber="13">
            
              <span class="hits">369</span>
            

            
              
            

            <code class="ruby">        @force = force</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="369" data-linenumber="14">
            
              <span class="hits">369</span>
            

            
              
            

            <code class="ruby">        started_at = Time.now</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="369" data-linenumber="15">
            
              <span class="hits">369</span>
            

            
              
            

            <code class="ruby">        step_results = {}</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="369" data-linenumber="16">
            
              <span class="hits">369</span>
            

            
              
            

            <code class="ruby">        outputs = {}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby">        begin</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="369" data-linenumber="19">
            
              <span class="hits">369</span>
            

            
              
            

            <code class="ruby">          dag.sorted_steps.each do |step|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="791" data-linenumber="20">
            
              <span class="hits">791</span>
            

            
              
            

            <code class="ruby">            step_result = execute_step(step, outputs, initial_input)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="789" data-linenumber="21">
            
              <span class="hits">789</span>
            

            
              
            

            <code class="ruby">            step_results[step.name] = step_result</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="789" data-linenumber="23">
            
              <span class="hits">789</span>
            

            
              
                <span class="hits" title="then branch hit 52 times">
                  then: 52
                </span>
              
                <span class="hits" title="else branch hit 737 times">
                  else: 737
                </span>
              
            

            <code class="ruby">            if step_result.failed?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="52" data-linenumber="24">
            
              <span class="hits">52</span>
            

            
              
            

            <code class="ruby">              raise StepError.new(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby">                &quot;Step &#39;#{step.name}&#39; failed: #{step_result.error.message}&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby">                step_name: step.name,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby">                original_error: step_result.error,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby">                partial_results: build_result(step_results, started_at)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby">              )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby">            end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="737" data-linenumber="32">
            
              <span class="hits">737</span>
            

            
              
            

            <code class="ruby">            outputs[step.name] = step_result.output</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="315" data-linenumber="35">
            
              <span class="hits">315</span>
            

            
              
            

            <code class="ruby">          build_result(step_results, started_at)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby">        rescue StepError</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="52" data-linenumber="37">
            
              <span class="hits">52</span>
            

            
              
            

            <code class="ruby">          raise</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby">        rescue StandardError =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="39">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">          Result.new(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            
              
            

            <code class="ruby">            step_results: step_results,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby">            started_at: started_at,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby">            finished_at: Time.now,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
            

            <code class="ruby">            error: e</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            
              
            

            <code class="ruby">          )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="48">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="50">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def execute_step(step, outputs, initial_input)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="791" data-linenumber="51">
            
              <span class="hits">791</span>
            

            
              
            

            <code class="ruby">        input = build_step_input(step, outputs, initial_input)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            
              
            

            <code class="ruby">        # Check cache first</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="791" data-linenumber="54">
            
              <span class="hits">791</span>
            

            
              
            

            <code class="ruby">        cached_result = check_cache(step, input, @cache, @force)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="791" data-linenumber="55">
            
              <span class="hits">791</span>
            

            
              
                <span class="hits" title="then branch hit 55 times">
                  then: 55
                </span>
              
                <span class="hits" title="else branch hit 736 times">
                  else: 736
                </span>
              
            

            <code class="ruby">        return cached_result if cached_result</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            
              
            

            <code class="ruby">        # Check conditions</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="736" data-linenumber="58">
            
              <span class="hits">736</span>
            

            
              
                <span class="hits" title="then branch hit 58 times">
                  then: 58
                </span>
              
                <span class="hits" title="else branch hit 677 times">
                  else: 677
                </span>
              
            

            <code class="ruby">        if should_skip_step?(step, input)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="58" data-linenumber="59">
            
              <span class="hits">58</span>
            

            
              
            

            <code class="ruby">          result = build_skipped_result(step)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="58" data-linenumber="60">
            
              <span class="hits">58</span>
            

            
              
            

            <code class="ruby">          write_cache(step, result, input, @cache)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="58" data-linenumber="61">
            
              <span class="hits">58</span>
            

            
              
            

            <code class="ruby">          return result</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            
              
            

            <code class="ruby">        # Execute and cache result</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="677" data-linenumber="65">
            
              <span class="hits">677</span>
            

            
              
            

            <code class="ruby">        result = execute_step_with_retry(step, input)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="676" data-linenumber="66">
            
              <span class="hits">676</span>
            

            
              
            

            <code class="ruby">        write_cache(step, result, input, @cache)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="676" data-linenumber="67">
            
              <span class="hits">676</span>
            

            
              
            

            <code class="ruby">        result</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="70">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def build_result(step_results, started_at)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="367" data-linenumber="71">
            
              <span class="hits">367</span>
            

            
              
            

            <code class="ruby">        Result.new(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            

            
              
            

            <code class="ruby">          step_results: step_results,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            

            
              
            

            <code class="ruby">          started_at: started_at,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            

            
              
            

            <code class="ruby">          finished_at: Time.now</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            
              
            

            <code class="ruby">        )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="981f896da180be5de83a0cd67e4b4b281e9cea99">
  <div class="header">
    <h3>lib/piperb/pipeline.rb</h3>
    <h4>
      <span class="yellow">
  87.8%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  58.33%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>41</b> relevant lines.
      <span class="green"><b>36</b> lines covered</span> and
      <span class="red"><b>5</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>12</b> total branches, </span>
          <span class="green"><b>7</b> branches covered</span> and
          <span class="red"><b>5</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">module Piperb</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby">  # User-facing DSL class for defining and executing pipelines.</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="5">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  class Pipeline</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="6">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    attr_reader :dag</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="8">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def initialize(&amp;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="363" data-linenumber="9">
            
              <span class="hits">363</span>
            

            
              
            

            <code class="ruby">      @dag = DAG.new</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="363" data-linenumber="10">
            
              <span class="hits">363</span>
            

            
              
            

            <code class="ruby">      @executor_class = Executor::Sequential</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="363" data-linenumber="11">
            
              <span class="hits">363</span>
            

            
              
                <span class="hits" title="then branch hit 358 times">
                  then: 358
                </span>
              
                <span class="hits" title="else branch hit 5 times">
                  else: 5
                </span>
              
            

            <code class="ruby">      instance_eval(&amp;) if block_given?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="14">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def step(name, depends_on: [], **options, &amp;block)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1131" data-linenumber="15">
            
              <span class="hits">1131</span>
            

            
              
            

            <code class="ruby">      step = Step.new(name, depends_on: depends_on, **options, &amp;block)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1131" data-linenumber="16">
            
              <span class="hits">1131</span>
            

            
              
            

            <code class="ruby">      dag.add(step)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1128" data-linenumber="17">
            
              <span class="hits">1128</span>
            

            
              
            

            <code class="ruby">      self</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby">    # Runs the pipeline with the specified executor.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby">    #</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby">    # @param initial_input [Object] Input passed to root steps (steps with no dependencies)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby">    # @param executor [Symbol, Class] Executor to use (:sequential, :parallel, or a class)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby">    # @param max_threads [Integer, nil] Maximum concurrent threads for parallel executor</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby">    # @param cache [Cache::Base, String, nil] Cache store or directory path for result caching</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby">    # @param force [Boolean] Force re-execution, ignoring cache</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby">    # @return [Piperb::Result] The execution result</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="28">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def run(initial_input: nil, executor: :sequential, max_threads: nil, cache: nil, force: false)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="396" data-linenumber="29">
            
              <span class="hits">396</span>
            

            
              
            

            <code class="ruby">      executor_instance = build_executor(executor, max_threads)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="396" data-linenumber="30">
            
              <span class="hits">396</span>
            

            
              
            

            <code class="ruby">      cache_store = resolve_cache_store(cache)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="396" data-linenumber="31">
            
              <span class="hits">396</span>
            

            
              
            

            <code class="ruby">      executor_instance.execute(initial_input: initial_input, cache: cache_store, force: force)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="34">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def validate!</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="45" data-linenumber="35">
            
              <span class="hits">45</span>
            

            
              
            

            <code class="ruby">      dag.validate!</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="38">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def to_mermaid</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="39">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">      dag.to_mermaid</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="42">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def steps</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="43">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      dag.steps</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="46">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def [](step_name)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="47">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">      dag[step_name]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="50">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def empty?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="51">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">      dag.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="54">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def size</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="55">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">      dag.size</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="58">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="60">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def build_executor(executor, max_threads)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="396" data-linenumber="61">
            
              <span class="hits">396</span>
            

            
              
            

            <code class="ruby">      case executor</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            
              
                <span class="hits" title="when branch hit 345 times">
                  when: 345
                </span>
              
            

            <code class="ruby">      when :sequential</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="345" data-linenumber="63">
            
              <span class="hits">345</span>
            

            
              
            

            <code class="ruby">        Executor::Sequential.new(dag)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            
              
                <span class="hits" title="when branch hit 51 times">
                  when: 51
                </span>
              
            

            <code class="ruby">      when :parallel</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="51" data-linenumber="65">
            
              <span class="hits">51</span>
            

            
              
            

            <code class="ruby">        Executor::Parallel.new(dag, max_threads: max_threads)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="66">
            

            
              
                <span class="hits" title="when branch hit 0 times">
                  when: 0
                </span>
              
            

            <code class="ruby">      when Class</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="67">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">        if max_threads &amp;&amp; executor.instance_method(:initialize).arity != 1</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="68">
            

            
              
            

            <code class="ruby">          executor.new(dag, max_threads: max_threads)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="69">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">        else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="70">
            

            
              
            

            <code class="ruby">          executor.new(dag)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="72">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="73">
            

            
              
            

            <code class="ruby">        raise ArgumentError, &quot;Unknown executor: #{executor}. Use :sequential, :parallel, or a class.&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="77">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def resolve_cache_store(cache)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="396" data-linenumber="78">
            
              <span class="hits">396</span>
            

            
              
                <span class="hits" title="when branch hit 284 times">
                  when: 284
                </span>
              
            

            <code class="ruby">      case cache</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            

            
              
            

            <code class="ruby">      when nil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            

            
              
            

            <code class="ruby">        nil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            

            
              
                <span class="hits" title="when branch hit 2 times">
                  when: 2
                </span>
              
            

            <code class="ruby">      when String</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="82">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">        Cache::FileStore.new(cache)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            

            
              
                <span class="hits" title="when branch hit 110 times">
                  when: 110
                </span>
              
            

            <code class="ruby">      when Cache::Base</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="110" data-linenumber="84">
            
              <span class="hits">110</span>
            

            
              
            

            <code class="ruby">        cache</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="85">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="86">
            

            
              
            

            <code class="ruby">        raise ArgumentError, &quot;Invalid cache option: #{cache.class}. Use a path string or Cache::Base instance.&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="87">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="1bfe9d8600c4b5ad878e0972ebd5743ea3f85dc7">
  <div class="header">
    <h3>lib/piperb/result.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>53</b> relevant lines.
      <span class="green"><b>53</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>12</b> total branches, </span>
          <span class="green"><b>12</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">module Piperb</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby">  # Represents the result of executing a single step.</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="5">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  class StepResult</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="6">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    attr_reader :step_name, :output, :duration, :started_at, :error, :retries</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="8">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def initialize(step_name:, output: nil, duration: nil, started_at: nil, error: nil, status: nil, retries: 0,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby">                   timed_out: false)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1294" data-linenumber="10">
            
              <span class="hits">1294</span>
            

            
              
            

            <code class="ruby">      @step_name = step_name</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1294" data-linenumber="11">
            
              <span class="hits">1294</span>
            

            
              
            

            <code class="ruby">      @output = output</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1294" data-linenumber="12">
            
              <span class="hits">1294</span>
            

            
              
            

            <code class="ruby">      @duration = duration</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1294" data-linenumber="13">
            
              <span class="hits">1294</span>
            

            
              
            

            <code class="ruby">      @started_at = started_at</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1294" data-linenumber="14">
            
              <span class="hits">1294</span>
            

            
              
            

            <code class="ruby">      @error = error</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1294" data-linenumber="15">
            
              <span class="hits">1294</span>
            

            
              
            

            <code class="ruby">      @status = status</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1294" data-linenumber="16">
            
              <span class="hits">1294</span>
            

            
              
            

            <code class="ruby">      @retries = retries</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1294" data-linenumber="17">
            
              <span class="hits">1294</span>
            

            
              
            

            <code class="ruby">      @timed_out = timed_out</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="20">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def status</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2481" data-linenumber="21">
            
              <span class="hits">2481</span>
            

            
              
                <span class="hits" title="then branch hit 7 times">
                  then: 7
                </span>
              
                <span class="hits" title="else branch hit 3 times">
                  else: 3
                </span>
              
            

            <code class="ruby">      @status || (error ? :failed : :success)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="24">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def success?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="25">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">      status == :success</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="28">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def failed?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2175" data-linenumber="29">
            
              <span class="hits">2175</span>
            

            
              
            

            <code class="ruby">      status == :failed</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="32">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    alias failure? failed?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="34">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def skipped?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="188" data-linenumber="35">
            
              <span class="hits">188</span>
            

            
              
            

            <code class="ruby">      status == :skipped</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="38">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def timed_out?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="39">
            
              <span class="hits">12</span>
            

            
              
            

            <code class="ruby">      @timed_out</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="42">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def to_h</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
            

            <code class="ruby">      {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="44">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">        step_name: step_name,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby">        output: output,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
            

            <code class="ruby">        duration: duration,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            
              
            

            <code class="ruby">        started_at: started_at,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            
              
            

            <code class="ruby">        error: error,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
            

            <code class="ruby">        status: status,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            
              
            

            <code class="ruby">        retries: retries,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            
              
            

            <code class="ruby">        timed_out: timed_out?,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            
              
            

            <code class="ruby">        skipped: skipped?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="56">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def inspect</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="57">
            
              <span class="hits">5</span>
            

            
              
                <span class="hits" title="then branch hit 4 times">
                  then: 4
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">      &quot;#&lt;Piperb::StepResult step=#{step_name.inspect} status=#{status.inspect} duration=#{duration&amp;.round(4)}&gt;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            

            
              
            

            <code class="ruby">  # Represents the overall result of executing a pipeline.</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="62">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  class Result</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="63">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    attr_reader :step_results, :started_at, :finished_at, :error</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="65">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def initialize(step_results: {}, started_at: nil, finished_at: nil, error: nil)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="473" data-linenumber="66">
            
              <span class="hits">473</span>
            

            
              
            

            <code class="ruby">      @step_results = step_results</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="473" data-linenumber="67">
            
              <span class="hits">473</span>
            

            
              
            

            <code class="ruby">      @started_at = started_at</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="473" data-linenumber="68">
            
              <span class="hits">473</span>
            

            
              
            

            <code class="ruby">      @finished_at = finished_at</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="473" data-linenumber="69">
            
              <span class="hits">473</span>
            

            
              
            

            <code class="ruby">      @error = error</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="72">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def [](step_name)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="652" data-linenumber="73">
            
              <span class="hits">652</span>
            

            
              
            

            <code class="ruby">      step_results[step_name.to_sym]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="76">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def success?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="199" data-linenumber="77">
            
              <span class="hits">199</span>
            

            
              
            

            <code class="ruby">      error.nil? &amp;&amp; step_results.values.none?(&amp;:failed?)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="80">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def failed?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="81">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">      !success?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="84">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    alias failure? failed?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="86">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def duration</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="23" data-linenumber="87">
            
              <span class="hits">23</span>
            

            
              
                <span class="hits" title="else branch hit 11 times">
                  else: 11
                </span>
              
                <span class="hits" title="then branch hit 12 times">
                  then: 12
                </span>
              
            

            <code class="ruby">      return nil unless started_at &amp;&amp; finished_at</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="89">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">      finished_at - started_at</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="92">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def outputs</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="93">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">      step_results.transform_values(&amp;:output)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="96">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def completed_steps</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="97">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">      step_results.keys</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="98">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="99">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="100">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def to_h</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="101">
            

            
              
            

            <code class="ruby">      {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="102">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">        success: success?,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="103">
            

            
              
            

            <code class="ruby">        duration: duration,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="104">
            

            
              
            

            <code class="ruby">        started_at: started_at,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="105">
            

            
              
            

            <code class="ruby">        finished_at: finished_at,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="106">
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 4 times">
                  else: 4
                </span>
              
            

            <code class="ruby">        error: error&amp;.message,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="107">
            

            
              
            

            <code class="ruby">        steps: step_results.transform_values(&amp;:to_h)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="108">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="109">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="110">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="111">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def inspect</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="112">
            
              <span class="hits">6</span>
            

            
              
                <span class="hits" title="then branch hit 5 times">
                  then: 5
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">      status = success? ? &#39;success&#39; : &#39;failed&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="113">
            
              <span class="hits">6</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 5 times">
                  else: 5
                </span>
              
            

            <code class="ruby">      &quot;#&lt;Piperb::Result status=#{status} steps=#{step_results.size} duration=#{duration&amp;.round(4)}&gt;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="114">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="115">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="116">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="2fa213accbaf6ee333c08afa4fb43ece9e83a48d">
  <div class="header">
    <h3>lib/piperb/step.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="yellow">
  87.5%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>45</b> relevant lines.
      <span class="green"><b>45</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>8</b> total branches, </span>
          <span class="green"><b>7</b> branches covered</span> and
          <span class="red"><b>1</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">module Piperb</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby">  # Represents an atomic unit of work in a pipeline.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby">  # Steps are immutable after creation for thread safety.</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="6">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  class Step</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="7">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    attr_reader :name, :dependencies, :callable, :options</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="9">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def initialize(name, depends_on: [], callable: nil, **options, &amp;block)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1431" data-linenumber="10">
            
              <span class="hits">1431</span>
            

            
              
            

            <code class="ruby">      @name = name.to_sym</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1431" data-linenumber="11">
            
              <span class="hits">1431</span>
            

            
              
            

            <code class="ruby">      @dependencies = normalize_dependencies(depends_on)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1431" data-linenumber="12">
            
              <span class="hits">1431</span>
            

            
              
            

            <code class="ruby">      @callable = callable || block</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1431" data-linenumber="13">
            
              <span class="hits">1431</span>
            

            
              
            

            <code class="ruby">      @options = options.freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1431" data-linenumber="15">
            
              <span class="hits">1431</span>
            

            
              
            

            <code class="ruby">      validate!</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1429" data-linenumber="16">
            
              <span class="hits">1429</span>
            

            
              
            

            <code class="ruby">      freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="19">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def call(*args, **kwargs)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1233" data-linenumber="20">
            
              <span class="hits">1233</span>
            

            
              
                <span class="hits" title="then branch hit 1140 times">
                  then: 1140
                </span>
              
            

            <code class="ruby">      if kwargs.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1140" data-linenumber="21">
            
              <span class="hits">1140</span>
            

            
              
            

            <code class="ruby">        callable.call(*args)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
                <span class="hits" title="else branch hit 93 times">
                  else: 93
                </span>
              
            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="93" data-linenumber="23">
            
              <span class="hits">93</span>
            

            
              
            

            <code class="ruby">        callable.call(*args, **kwargs)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby">    # Retry options</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="28">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def retries</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1115" data-linenumber="29">
            
              <span class="hits">1115</span>
            

            
              
            

            <code class="ruby">      options.fetch(:retries, 0)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="32">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def retry_delay</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="93" data-linenumber="33">
            
              <span class="hits">93</span>
            

            
              
            

            <code class="ruby">      options.fetch(:retry_delay, 0)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="36">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def retry_backoff</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22" data-linenumber="37">
            
              <span class="hits">22</span>
            

            
              
            

            <code class="ruby">      options.fetch(:retry_backoff, nil)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="40">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def retry_if</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="97" data-linenumber="41">
            
              <span class="hits">97</span>
            

            
              
            

            <code class="ruby">      options.fetch(:retry_if, nil)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            
              
            

            <code class="ruby">    # Timeout options</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="45">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def timeout</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1298" data-linenumber="46">
            
              <span class="hits">1298</span>
            

            
              
            

            <code class="ruby">      options.fetch(:timeout, nil)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
            

            <code class="ruby">    # Conditional execution options</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="50">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def if_condition</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1294" data-linenumber="51">
            
              <span class="hits">1294</span>
            

            
              
            

            <code class="ruby">      options.fetch(:if, nil)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="54">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def unless_condition</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1183" data-linenumber="55">
            
              <span class="hits">1183</span>
            

            
              
            

            <code class="ruby">      options.fetch(:unless, nil)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="58">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def conditional?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1177" data-linenumber="59">
            
              <span class="hits">1177</span>
            

            
              
            

            <code class="ruby">      !if_condition.nil? || !unless_condition.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            
              
            

            <code class="ruby">    # Cache options</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="63">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def cache_enabled?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            
              
            

            <code class="ruby">      # Default to true unless explicitly set to false</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="262" data-linenumber="65">
            
              <span class="hits">262</span>
            

            
              
            

            <code class="ruby">      options.fetch(:cache, true)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="68">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def cache_key</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="254" data-linenumber="69">
            
              <span class="hits">254</span>
            

            
              
            

            <code class="ruby">      options.fetch(:cache_key, nil)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="72">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def to_s</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="73">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      &quot;Step(#{name})&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="76">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def inspect</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="77">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      &quot;#&lt;Piperb::Step name=#{name.inspect} dependencies=#{dependencies.inspect}&gt;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="80">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="82">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def normalize_dependencies(deps)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1431" data-linenumber="83">
            
              <span class="hits">1431</span>
            

            
              
            

            <code class="ruby">      Array(deps).map(&amp;:to_sym).freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="86">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def validate!</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="1431" data-linenumber="87">
            
              <span class="hits">1431</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 1431 times">
                  else: 1431
                </span>
              
            

            <code class="ruby">      raise ArgumentError, &#39;Step name cannot be nil&#39; if name.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1431" data-linenumber="88">
            
              <span class="hits">1431</span>
            

            
              
                <span class="hits" title="else branch hit 1430 times">
                  else: 1430
                </span>
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">      raise ArgumentError, &#39;Step must have a callable (block, Proc, or object responding to #call)&#39; unless callable</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1430" data-linenumber="89">
            
              <span class="hits">1430</span>
            

            
              
                <span class="hits" title="else branch hit 1429 times">
                  else: 1429
                </span>
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">      raise ArgumentError, &#39;Callable must respond to #call&#39; unless callable.respond_to?(:call)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="92">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
      </div>
    </div>
  </body>
</html>
